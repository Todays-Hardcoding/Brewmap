<!DOCTYPE html>
<html
	lang="ko"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
	<head th:replace="layout/head :: headFragment"> </head>
	<th:block layout:fragment="css">
	<link rel="stylesheet" th:href="@{/assets/css/storeList.css}" type="text/css">
	</th:block>

<body>
	<script src="http://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script type="text/javascript">
	function toListByRate(){
		// HTML5의 geolocation으로 사용할 수 있는지 확인합니다 
		if (navigator.geolocation) {
		    // GeoLocation을 이용해서 접속 위치를 얻어옵니다
		    navigator.geolocation.getCurrentPosition(function(position) { 
	        var lat = position.coords.latitude, // 위도
	            lon = position.coords.longitude; // 경도  
	            
	         // 위도, 경도를 Map<String, String> 형식으로 저장
	    	var params = {
    			"lat" : lat,
    			"lon" : lon 
	   		}
	         
	    	console.log(params.lat);
	        console.log(params.lon);
	        
	        document.location.href = "/storeListByRate?lat="+lat+"&lon="+lon;
/*	        
	    	$.ajax({
	    		type: "get",   //get방식으로 명시
	    		url : "/storeList",  //이동할 jsp 파일 주소
	    		data : params
	    	})
*/
		});
		} else { // HTML5의 GeoLocation을 사용할 수 없을때 마커 표시 위치와 인포윈도우 내용을 설정합니다
			alert("geolocation error");
		}	
	};
	</script>
	<script type="text/javascript">
	function toListByReview(){
		// HTML5의 geolocation으로 사용할 수 있는지 확인합니다 
		if (navigator.geolocation) {
		    // GeoLocation을 이용해서 접속 위치를 얻어옵니다
		    navigator.geolocation.getCurrentPosition(function(position) { 
	        var lat = position.coords.latitude, // 위도
	            lon = position.coords.longitude; // 경도  
	            
	         // 위도, 경도를 Map<String, String> 형식으로 저장
	    	var params = {
    			"lat" : lat,
    			"lon" : lon 
	   		}
	         
	    	console.log(params.lat);
	        console.log(params.lon);
	        
	        document.location.href = "/storeListByReview?lat="+lat+"&lon="+lon;
/*	        
	    	$.ajax({
	    		type: "get",   //get방식으로 명시
	    		url : "/storeList",  //이동할 jsp 파일 주소
	    		data : params
	    	})
*/
		});
		} else { // HTML5의 GeoLocation을 사용할 수 없을때 마커 표시 위치와 인포윈도우 내용을 설정합니다
			alert("geolocation error");
		}	
	};
	</script>
	
	<!-- 헤더 페이지 불러오기 -->
	<div th:replace="/layout/header.html :: header"></div>
	
    <section class="article-list">

        <div class="container">
					<div class="sorting-container">
						<spqn>정렬방법&nbsp;&nbsp;&nbsp;| </spqn>
						<a class="" onClick="toListByRate()">평점순서</a>
    				<a class="" onClick="toListByReview()">리뷰 많은 순서</a>
					</div>
					
            <div class="row articles" >
            	<!-- 리스트 불러오기 반복문 -->
							<th:block th:each="storeList : ${infoList}">
								<div class="col-sm-6 col-md-4 item">
									<div class="card-container">

										<div class="card">
											<a th:href="@{/detail (id=${storeList.value.storeCode})}">
												<img class="img-fluid" th:src="'assets/img/storeImg/' + ${storeList.value.storeName} + '/' + ${storeList.value.storeCode} + '_1.png/'" />
												<div class="card-body">
													<h5 class="card-title" th:text="${storeList.value.storeName}"></h5>
													<p class="card-text"th:text="${storeList.key} + ' 킬로미터 부근'" ></p>
													<p class="card-text"th:text="${storeList.value.storeCategory}"></p>
													<p class="card-text"th:text="${storeList.value.storeRoadAddr}"></p>
													<span class="star">★</span>
													<span class="card-text rate"th:text="${storeList.value.storeStaravg}"></span>
												</div>
											</a>
										</div>
										
									</div>
						</div>
						</th:block>

            </div>
            
            <!-- 
            <div id="pagination">
				<th:block th:each="page : ${#numbers.sequence(startPage, endPage)}">
					<a th:if="${page != nowPage}" th:href="@{/storeList(page=${page-1})}" th:text="${page}"></a>
					<a th:if="${page == nowPage}" th:text="${page}"></a>
				</th:block>
			</div>
			 -->
        </div>
        
    </section>	

    <!-- 푸터 페이지 불러오기 -->
    <footer th:replace="/layout/footer.html :: footer"></footer>
	<script src="assets/bootstrap/js/bootstrap.min.js"></script>

	<script th:inline="javascript">
	
	var infoList = [[${infoList}]];
	console.log(infoList);
	
	$(document).ready(function(){
		// HTML5의 geolocation으로 사용할 수 있는지 확인합니다 
		if (navigator.geolocation) {
		    //GeoLocation을 이용해서 접속 위치를 얻어옵니다
		    navigator.geolocation.getCurrentPosition(function(position) { 
	        var lat = position.coords.latitude, // 위도
	            lon = position.coords.longitude; // 경도  
	            
	         // 위도, 경도를 Map<String, String> 형식으로 저장
        	var params = {
        			"lat" : lat,
        			"lon" : lon 
       		}
        	console.log(params.lat);
            console.log(params.lon);
            
        	$.ajax({
        		type: "get",   //get방식으로 명시
        		url : "/storeList",  //이동할 jsp 파일 주소
        		data : params
        	})
		});
		    
		} else { // HTML5의 GeoLocation을 사용할 수 없을때 마커 표시 위치와 인포윈도우 내용을 설정합니다
			alert("geolocation error");
		}	
    });
	</script>
</body>
</html>